#!/bin/bash

# kubctl-0x01 - Scale Django deployment, verify pods, load test with wrk, and monitor resource usage

set -e

DEPLOYMENT_NAME="messaging-app-deployment"
NAMESPACE="default"  # change if using another namespace
SERVICE_NAME="messaging-app-service"
SERVICE_PORT=8000    # port exposed by service

# Check if kubectl is installed
if ! command -v kubectl &>/dev/null; then
    echo "‚ùå kubectl is not installed. Please install it first."
    exit 1
fi

# Check if wrk is installed
if ! command -v wrk &>/dev/null; then
    echo "‚ùå wrk is not installed. Please install wrk to proceed."
    echo "On Ubuntu: sudo apt install wrk"
    exit 1
fi

echo "üîÑ Scaling deployment '$DEPLOYMENT_NAME' to 3 replicas..."
kubectl scale deployment "$DEPLOYMENT_NAME" --replicas=3 -n "$NAMESPACE"

echo "‚è≥ Waiting for pods to be ready..."
# Wait until all replicas are ready
kubectl rollout status deployment/"$DEPLOYMENT_NAME" -n "$NAMESPACE"

echo "‚úÖ Pods after scaling:"
kubectl get pods -l app=messaging-app -n "$NAMESPACE"

# Get ClusterIP of t
